{% extends 'layouts/base.html' %}
{% load static %}
{% block content %}

<style>
    :root {
        --primary: #4361ee;
        --secondary: #3f37c9;
        --accent: #4cc9f0;
        --dark: #1a1a2e;
        --darker: #0d0d1a;
        --light: #f8f9fa;
        --gray: #6c757d;
        --success: #4ade80;
        --warning: #facc15;
        --error: #f87171;
        --resume-bg: #ffffff;
        --resume-text: #333333;
        --resume-header: #2c3e50;
        --resume-section: #34495e;
    }
    
    .resume-builder {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    /* Header */
    .resume-header {
        background: white;
        border-radius: 12px;
        padding: 20px 40px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 20px;
    }
    
    .logo {
        display: flex;
        align-items: center;
        gap: 12px;
        color: var(--dark);
        font-size: 1.8rem;
        font-weight: 700;
        text-decoration: none;
    }
    
    .logo i {
        color: var(--primary);
        font-size: 2.2rem;
    }
    
    .header-actions {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }
    
    .btn {
        padding: 12px 25px;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: inline-flex;
        align-items: center;
        gap: 8px;
    }
    
    .btn-primary {
        background: linear-gradient(90deg, var(--primary), var(--accent));
        color: white;
        box-shadow: 0 4px 15px rgba(67, 97, 238, 0.3);
    }
    
    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(67, 97, 238, 0.4);
    }
    
    .btn-secondary {
        background: white;
        color: var(--primary);
        border: 2px solid var(--primary);
    }
    
    .btn-secondary:hover {
        background: rgba(67, 97, 238, 0.05);
    }
    
    /* Main Content */
    .builder-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 40px;
    }
    
    /* Form Section */
    .form-section {
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        height: fit-content;
    }
    
    .section-title {
        font-size: 1.5rem;
        margin-bottom: 25px;
        color: var(--resume-header);
        padding-bottom: 10px;
        border-bottom: 2px solid var(--accent);
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--resume-section);
    }
    
    .form-control {
        width: 100%;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid #ddd;
        font-size: 1rem;
        transition: all 0.3s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(76, 201, 240, 0.2);
    }
    
    textarea.form-control {
        min-height: 100px;
        resize: vertical;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    
    .add-btn {
        background: var(--success);
        color: white;
        border: none;
        border-radius: 50%;
        width: 36px;
        height: 36px;
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 10px;
    }
    
    .form-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .section-toggle {
        background: none;
        border: none;
        color: var(--gray);
        cursor: pointer;
        font-size: 1.2rem;
    }
    
    /* Resume Preview */
    .preview-section {
        background: white;
        border-radius: 16px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        height: fit-content;
        position: sticky;
        top: 20px;
        display: flex;
        flex-direction: column;
    }
    
    .preview-header {
        background: var(--resume-header);
        color: white;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .preview-title {
        font-size: 1.3rem;
        font-weight: 700;
    }
    
    #resume-preview {
        padding: 30px;
        background: var(--resume-bg);
        color: var(--resume-text);
        min-height: 800px;
        flex-grow: 1;
    }
    
    .resume-header-preview {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid var(--primary);
    }
    
    .resume-name {
        font-size: 2.2rem;
        font-weight: 700;
        color: var(--resume-header);
        margin-bottom: 5px;
    }
    
    .resume-title {
        font-size: 1.3rem;
        color: var(--resume-section);
        margin-bottom: 15px;
    }
    
    .resume-contact {
        display: flex;
        justify-content: center;
        flex-wrap: wrap;
        gap: 20px;
        font-size: 0.95rem;
    }
    
    .resume-contact div {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .resume-section {
        margin-bottom: 25px;
    }
    
    .resume-section-title {
        font-size: 1.3rem;
        color: var(--resume-header);
        margin-bottom: 12px;
        padding-bottom: 5px;
        border-bottom: 1px solid #eee;
        font-weight: 600;
    }
    
    .resume-item {
        margin-bottom: 20px;
    }
    
    .resume-item-header {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-bottom: 5px;
    }
    
    .resume-item-title {
        font-weight: 600;
        font-size: 1.1rem;
        color: var(--resume-section);
    }
    
    .resume-item-subtitle {
        font-style: italic;
        color: #666;
        margin-bottom: 8px;
    }
    
    .resume-item-date {
        color: #777;
        font-size: 0.9rem;
    }
    
    .resume-item-desc {
        line-height: 1.6;
    }
    
    .skills-list {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .skill-tag {
        background: rgba(67, 97, 238, 0.1);
        color: var(--primary);
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    
    /* Template Selector */
    .template-selector {
        display: flex;
        gap: 15px;
        margin-top: 20px;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .template-option {
        width: 80px;
        height: 110px;
        border: 2px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .template-option:hover, .template-option.active {
        border-color: var(--primary);
        transform: translateY(-5px);
    }
    
    .template-1 {
        background: linear-gradient(to bottom, #2c3e50 0%, #2c3e50 20%, #ffffff 20%, #ffffff 100%);
    }
    
    .template-2 {
        background: linear-gradient(to bottom, #34495e 0%, #34495e 20%, #ffffff 20%, #ffffff 100%);
    }
    
    .template-3 {
        background: linear-gradient(to bottom, #4361ee 0%, #4361ee 20%, #ffffff 20%, #ffffff 100%);
    }
    
    .template-4 {
        background: linear-gradient(to bottom, #4cc9f0 0%, #4cc9f0 20%, #ffffff 20%, #ffffff 100%);
    }
    
    .template-name {
        position: absolute;
        bottom: 5px;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 0.7rem;
        font-weight: 600;
        color: #333;
    }
    
    /* Toast Notification */
    .toast {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: var(--success);
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        display: flex;
        align-items: center;
        gap: 10px;
        z-index: 1000;
        transform: translateY(100px);
        opacity: 0;
        transition: all 0.4s ease;
    }
    
    .toast.show {
        transform: translateY(0);
        opacity: 1;
    }
    
    /* Mobile menu */
    .mobile-menu-btn {
        display: none;
        background: transparent;
        border: none;
        font-size: 1.5rem;
        color: var(--primary);
        cursor: pointer;
    }
    
    /* Experience item */
    .experience-item, .education-item {
        background: #f9f9f9;
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        position: relative;
    }
    
    .remove-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        background: var(--error);
        color: white;
        border: none;
        border-radius: 50%;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }
    
    /* Feature highlights */
    .features-highlight {
        display: flex;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 20px;
        margin: 30px 0;
        padding: 20px;
        background: linear-gradient(135deg, #f0f4ff 0%, #e6f7ff 100%);
        border-radius: 12px;
    }
    
    .feature-item {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 500;
    }
    
    .feature-item i {
        color: var(--primary);
        font-size: 1.2rem;
    }
    
    /* Progress bar */
    .progress-container {
        margin: 20px 0;
        background: #f0f0f0;
        border-radius: 10px;
        height: 10px;
        overflow: hidden;
    }
    
    .progress-bar {
        height: 100%;
        background: var(--primary);
        width: 65%;
        transition: width 0.5s ease;
    }
    
    .progress-text {
        text-align: center;
        font-weight: 500;
        color: var(--primary);
        margin-top: 5px;
    }
    
    /* ========== RESPONSIVE DESIGN ========== */
    /* For tablets and medium screens */
    @media (max-width: 992px) {
        .builder-container {
            grid-template-columns: 1fr;
        }
        
        .preview-section {
            position: relative;
            top: 0;
            margin-top: 30px;
        }
        
        .resume-header {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .header-actions {
            justify-content: center;
        }
        
        .features-highlight {
            justify-content: center;
        }
        
        .progress-container {
            margin: 20px 20px;
        }
    }
    
    /* For smaller tablets and large phones */
    @media (max-width: 768px) {
        .resume-builder {
            padding: 15px;
        }
        
        .resume-header {
            padding: 15px;
        }
        
        .form-section, .preview-section {
            padding: 20px;
        }
        
        .form-row {
            grid-template-columns: 1fr;
        }
        
        .resume-name {
            font-size: 1.8rem;
        }
        
        .resume-title {
            font-size: 1.1rem;
        }
        
        .resume-contact {
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .resume-item-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .resume-item-date {
            margin-top: 5px;
            font-size: 0.85rem;
        }
        
        .mobile-menu-btn {
            display: block;
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 100;
            background: white;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        #resume-form {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 99;
            padding: 70px 20px 20px;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        #resume-form.mobile-visible {
            transform: translateX(0);
        }
        
        .form-section-header {
            position: sticky;
            top: 0;
            background: white;
            padding: 15px 0;
            z-index: 10;
        }
    }
    
    /* For mobile phones */
    @media (max-width: 576px) {
        .logo {
            font-size: 1.5rem;
        }
        
        .logo i {
            font-size: 1.8rem;
        }
        
        .btn {
            padding: 10px 20px;
            font-size: 0.9rem;
        }
        
        .section-title {
            font-size: 1.3rem;
        }
        
        .resume-name {
            font-size: 1.6rem;
        }
        
        .resume-section-title {
            font-size: 1.1rem;
        }
        
        .resume-item-title {
            font-size: 1rem;
        }
        
        .features-highlight {
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        
        .template-option {
            width: 70px;
            height: 95px;
        }
        
        .progress-text {
            font-size: 0.9rem;
        }
    }
    
    /* For very small phones */
    @media (max-width: 400px) {
        .header-actions {
            flex-direction: column;
            width: 100%;
        }
        
        .btn {
            width: 100%;
            justify-content: center;
        }
        
        .resume-header {
            gap: 15px;
        }
        
        .preview-header {
            flex-direction: column;
            gap: 10px;
        }
        
        .preview-actions {
            width: 100%;
        }
        
        .btn-secondary {
            width: 100%;
        }
    }
    
    /* Print styles */
    @media print {
        .resume-header, .form-section, .preview-header, .btn, .mobile-menu-btn, 
        .features-highlight, .progress-container, .progress-text {
            display: none !important;
        }
        
        #resume-preview {
            min-height: auto;
            padding: 20px;
            box-shadow: none;
        }
        
        body {
            padding: 0;
            background: white;
        }
    }
</style>

<div class="resume-builder">
    <!-- Header -->
    <header class="resume-header">
        <div class="logo">
            <i class="fas fa-file-alt"></i>
            <span>ResumeCraft Pro</span>
        </div>
        <div class="header-actions">
            <button class="btn btn-secondary" id="reset-btn">
                <i class="fas fa-redo"></i> Reset
            </button>
            <button class="btn btn-primary" id="download-btn">
                <i class="fas fa-download"></i> Download PDF
            </button>
        </div>
    </header>
    
    <!-- Feature Highlights -->
    <div class="features-highlight">
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Professional Templates</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Real-time Preview</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>PDF Export</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>Mobile Friendly</span>
        </div>
    </div>
    
    <!-- Progress Indicator -->
    <div class="progress-container">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="progress-text">Resume Completeness: <span id="progress-value">65%</span></div>
    
    <button class="mobile-menu-btn" id="mobile-menu-btn">
        <i class="fas fa-bars"></i>
    </button>
    
    <div class="builder-container">
        <!-- Form Section -->
        <div class="form-section">
            <div class="form-section-header">
                <h2 class="section-title">Build Your Resume</h2>
                <button class="section-toggle" id="toggle-form">
                    <i class="fas fa-chevron-up"></i>
                </button>
            </div>
            
            <div id="resume-form">
                <h3 class="section-subtitle">Personal Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="full-name">Full Name</label>
                        <input type="text" id="full-name" class="form-control" placeholder="John Doe">
                    </div>
                    <div class="form-group">
                        <label for="job-title">Professional Title</label>
                        <input type="text" id="job-title" class="form-control" placeholder="Software Engineer">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" class="form-control" placeholder="john.doe@example.com">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="text" id="phone" class="form-control" placeholder="(123) 456-7890">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="location">Location</label>
                    <input type="text" id="location" class="form-control" placeholder="New York, NY">
                </div>
                
                <div class="form-group">
                    <label for="summary">Professional Summary</label>
                    <textarea id="summary" class="form-control" placeholder="Experienced software engineer with 5+ years of experience..."></textarea>
                </div>
                
                <h3 class="section-subtitle">Work Experience</h3>
                <div class="form-group" id="experience-container">
                    <div class="experience-item">
                        <button class="remove-btn">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Job Title</label>
                                <input type="text" class="form-control exp-title" placeholder="Senior Developer">
                            </div>
                            <div class="form-group">
                                <label>Company</label>
                                <input type="text" class="form-control exp-company" placeholder="Tech Company Inc.">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Start Date</label>
                                <input type="text" class="form-control exp-start" placeholder="Jan 2020">
                            </div>
                            <div class="form-group">
                                <label>End Date</label>
                                <input type="text" class="form-control exp-end" placeholder="Present">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Description</label>
                            <textarea class="form-control exp-desc" placeholder="Responsibilities and achievements..."></textarea>
                        </div>
                    </div>
                </div>
                <button class="add-btn" id="add-experience">
                    <i class="fas fa-plus"></i>
                </button>
                
                <h3 class="section-subtitle">Education</h3>
                <div class="form-group" id="education-container">
                    <div class="education-item">
                        <button class="remove-btn">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Degree</label>
                                <input type="text" class="form-control edu-degree" placeholder="Bachelor of Science">
                            </div>
                            <div class="form-group">
                                <label>Institution</label>
                                <input type="text" class="form-control edu-school" placeholder="University of Technology">
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Field of Study</label>
                                <input type="text" class="form-control edu-field" placeholder="Computer Science">
                            </div>
                            <div class="form-group">
                                <label>Graduation Year</label>
                                <input type="text" class="form-control edu-year" placeholder="2018">
                            </div>
                        </div>
                    </div>
                </div>
                <button class="add-btn" id="add-education">
                    <i class="fas fa-plus"></i>
                </button>
                
                <h3 class="section-subtitle">Skills</h3>
                <div class="form-group" id="skills-container">
                    <div class="form-row">
                        <div class="form-group">
                            <input type="text" class="form-control skill-input" placeholder="JavaScript, Python, etc.">
                        </div>
                    </div>
                </div>
                
                <h3 class="section-subtitle">Choose Template</h3>
                <div class="template-selector">
                    <div class="template-option template-1 active" data-template="1">
                        <div class="template-name">Classic</div>
                    </div>
                    <div class="template-option template-2" data-template="2">
                        <div class="template-name">Modern</div>
                    </div>
                    <div class="template-option template-3" data-template="3">
                        <div class="template-name">Blue</div>
                    </div>
                    <div class="template-option template-4" data-template="4">
                        <div class="template-name">Clean</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Preview Section -->
        <div class="preview-section">
            <div class="preview-header">
                <div class="preview-title">Resume Preview</div>
                <div class="preview-actions">
                    <button class="btn btn-secondary" id="print-btn">
                        <i class="fas fa-print"></i> Print
                    </button>
                </div>
            </div>
            <div id="resume-preview">
                <div class="resume-header-preview">
                    <div class="resume-name" id="preview-name">John Doe</div>
                    <div class="resume-title" id="preview-title">Software Engineer</div>
                    <div class="resume-contact">
                        <div id="preview-email">john.doe@example.com</div>
                        <div id="preview-phone">(123) 456-7890</div>
                        <div id="preview-location">New York, NY</div>
                    </div>
                </div>
                
                <div class="resume-section">
                    <div class="resume-section-title">Professional Summary</div>
                    <div class="resume-item-desc" id="preview-summary">
                        Experienced software engineer with 5+ years of experience in developing scalable web applications. Proficient in JavaScript, Python, and cloud technologies.
                    </div>
                </div>
                
                <div class="resume-section">
                    <div class="resume-section-title">Work Experience</div>
                    <div class="experience-list" id="preview-experience">
                        <div class="resume-item">
                            <div class="resume-item-header">
                                <div class="resume-item-title">Senior Developer</div>
                                <div class="resume-item-date">Jan 2020 - Present</div>
                            </div>
                            <div class="resume-item-subtitle">Tech Company Inc.</div>
                            <div class="resume-item-desc">
                                Lead development team in creating innovative solutions for enterprise clients. Implemented CI/CD pipelines reducing deployment time by 40%.
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="resume-section">
                    <div class="resume-section-title">Education</div>
                    <div class="education-list" id="preview-education">
                        <div class="resume-item">
                            <div class="resume-item-header">
                                <div class="resume-item-title">Bachelor of Science in Computer Science</div>
                                <div class="resume-item-date">2018</div>
                            </div>
                            <div class="resume-item-subtitle">University of Technology</div>
                        </div>
                    </div>
                </div>
                
                <div class="resume-section">
                    <div class="resume-section-title">Skills</div>
                    <div class="skills-list" id="preview-skills">
                        <div class="skill-tag">JavaScript</div>
                        <div class="skill-tag">Python</div>
                        <div class="skill-tag">React</div>
                        <div class="skill-tag">Node.js</div>
                        <div class="skill-tag">SQL</div>
                        <div class="skill-tag">AWS</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <i class="fas fa-check-circle"></i>
        <span>Resume downloaded successfully!</span>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const formInputs = document.querySelectorAll('#resume-form input, #resume-form textarea');
        const previewSection = document.getElementById('resume-preview');
        const addExperienceBtn = document.getElementById('add-experience');
        const addEducationBtn = document.getElementById('add-education');
        const downloadBtn = document.getElementById('download-btn');
        const resetBtn = document.getElementById('reset-btn');
        const printBtn = document.getElementById('print-btn');
        const templateOptions = document.querySelectorAll('.template-option');
        const toast = document.getElementById('toast');
        const progressBar = document.getElementById('progress-bar');
        const progressValue = document.getElementById('progress-value');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const resumeForm = document.getElementById('resume-form');
        
        // Initialize resume data
        let resumeData = {
            personal: {
                name: "John Doe",
                title: "Software Engineer",
                email: "john.doe@example.com",
                phone: "(123) 456-7890",
                location: "New York, NY",
                summary: "Experienced software engineer with 5+ years of experience in developing scalable web applications. Proficient in JavaScript, Python, and cloud technologies."
            },
            experience: [
                {
                    title: "Senior Developer",
                    company: "Tech Company Inc.",
                    start: "Jan 2020",
                    end: "Present",
                    description: "Lead development team in creating innovative solutions for enterprise clients. Implemented CI/CD pipelines reducing deployment time by 40%."
                }
            ],
            education: [
                {
                    degree: "Bachelor of Science in Computer Science",
                    school: "University of Technology",
                    field: "Computer Science",
                    year: "2018"
                }
            ],
            skills: ["JavaScript", "Python", "React", "Node.js", "SQL", "AWS"],
            template: "1"
        };
        
        // Initialize the form
        initializeForm();
        
        // Event Listeners
        formInputs.forEach(input => {
            input.addEventListener('input', updatePreview);
        });
        
        addExperienceBtn.addEventListener('click', addExperience);
        addEducationBtn.addEventListener('click', addEducation);
        downloadBtn.addEventListener('click', downloadPDF);
        resetBtn.addEventListener('click', resetForm);
        printBtn.addEventListener('click', printResume);
        mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        
        templateOptions.forEach(option => {
            option.addEventListener('click', function() {
                templateOptions.forEach(opt => opt.classList.remove('active'));
                this.classList.add('active');
                resumeData.template = this.dataset.template;
                applyTemplate();
            });
        });
        
        // Close form when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 768 && 
                !resumeForm.contains(e.target) && 
                e.target !== mobileMenuBtn &&
                resumeForm.classList.contains('mobile-visible')) {
                toggleMobileMenu();
            }
        });
        
        // Initialize form with sample data
        function initializeForm() {
            // Personal info
            document.getElementById('full-name').value = resumeData.personal.name;
            document.getElementById('job-title').value = resumeData.personal.title;
            document.getElementById('email').value = resumeData.personal.email;
            document.getElementById('phone').value = resumeData.personal.phone;
            document.getElementById('location').value = resumeData.personal.location;
            document.getElementById('summary').value = resumeData.personal.summary;
            
            // Skills
            document.querySelector('.skill-input').value = resumeData.skills.join(', ');
            
            // Apply template
            applyTemplate();
            updateProgress();
        }
        
        // Toggle mobile menu
        function toggleMobileMenu() {
            resumeForm.classList.toggle('mobile-visible');
            mobileMenuBtn.innerHTML = resumeForm.classList.contains('mobile-visible') ? 
                '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
            
            // Add overlay to body when form is visible
            if (resumeForm.classList.contains('mobile-visible')) {
                document.body.classList.add('form-open');
            } else {
                document.body.classList.remove('form-open');
            }
        }
        
        // Update progress bar
        function updateProgress() {
            let filledFields = 0;
            let totalFields = 0;
            
            // Count all form fields
            document.querySelectorAll('#resume-form input, #resume-form textarea').forEach(field => {
                totalFields++;
                if (field.value.trim() !== '') filledFields++;
            });
            
            // Count experience and education items
            filledFields += resumeData.experience.length + resumeData.education.length;
            totalFields += 2; // One for each section
            
            const percentage = Math.min(100, Math.round((filledFields / totalFields) * 100));
            progressBar.style.width = `${percentage}%`;
            progressValue.textContent = `${percentage}%`;
        }
        
        // Update preview based on form inputs
        function updatePreview() {
            // Update personal info
            resumeData.personal.name = document.getElementById('full-name').value || "John Doe";
            resumeData.personal.title = document.getElementById('job-title').value || "Professional Title";
            resumeData.personal.email = document.getElementById('email').value || "email@example.com";
            resumeData.personal.phone = document.getElementById('phone').value || "(123) 456-7890";
            resumeData.personal.location = document.getElementById('location').value || "City, Country";
            resumeData.personal.summary = document.getElementById('summary').value || "Professional summary...";
            
            // Update skills
            const skillsInput = document.querySelector('.skill-input').value;
            resumeData.skills = skillsInput.split(',').map(skill => skill.trim()).filter(skill => skill);
            
            // Update experience and education from form
            updateExperienceFromForm();
            updateEducationFromForm();
            updateProgress();
            
            // Update preview elements
            document.getElementById('preview-name').textContent = resumeData.personal.name;
            document.getElementById('preview-title').textContent = resumeData.personal.title;
            document.getElementById('preview-email').textContent = resumeData.personal.email;
            document.getElementById('preview-phone').textContent = resumeData.personal.phone;
            document.getElementById('preview-location').textContent = resumeData.personal.location;
            document.getElementById('preview-summary').textContent = resumeData.personal.summary;
            
            // Update experience preview
            const experienceList = document.getElementById('preview-experience');
            experienceList.innerHTML = '';
            
            resumeData.experience.forEach(exp => {
                const expElement = document.createElement('div');
                expElement.className = 'resume-item';
                expElement.innerHTML = `
                    <div class="resume-item-header">
                        <div class="resume-item-title">${exp.title}</div>
                        <div class="resume-item-date">${exp.start} - ${exp.end}</div>
                    </div>
                    <div class="resume-item-subtitle">${exp.company}</div>
                    <div class="resume-item-desc">${exp.description}</div>
                `;
                experienceList.appendChild(expElement);
            });
            
            // Update education preview
            const educationList = document.getElementById('preview-education');
            educationList.innerHTML = '';
            
            resumeData.education.forEach(edu => {
                const eduElement = document.createElement('div');
                eduElement.className = 'resume-item';
                eduElement.innerHTML = `
                    <div class="resume-item-header">
                        <div class="resume-item-title">${edu.degree}</div>
                        <div class="resume-item-date">${edu.year}</div>
                    </div>
                    <div class="resume-item-subtitle">${edu.school}</div>
                `;
                educationList.appendChild(eduElement);
            });
            
            // Update skills preview
            const skillsList = document.getElementById('preview-skills');
            skillsList.innerHTML = '';
            
            resumeData.skills.forEach(skill => {
                const skillElement = document.createElement('div');
                skillElement.className = 'skill-tag';
                skillElement.textContent = skill;
                skillsList.appendChild(skillElement);
            });
        }
        
        // Add new experience field
        function addExperience() {
            const container = document.getElementById('experience-container');
            const newItem = document.createElement('div');
            newItem.className = 'experience-item';
            newItem.innerHTML = `
                <button class="remove-btn">
                    <i class="fas fa-times"></i>
                </button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Job Title</label>
                        <input type="text" class="form-control exp-title" placeholder="Job Title">
                    </div>
                    <div class="form-group">
                        <label>Company</label>
                        <input type="text" class="form-control exp-company" placeholder="Company">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Start Date</label>
                        <input type="text" class="form-control exp-start" placeholder="Start Date">
                    </div>
                    <div class="form-group">
                        <label>End Date</label>
                        <input type="text" class="form-control exp-end" placeholder="End Date">
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea class="form-control exp-desc" placeholder="Description"></textarea>
                </div>
            `;
            
            container.appendChild(newItem);
            
            // Add event listener to the remove button
            const removeBtn = newItem.querySelector('.remove-btn');
            removeBtn.addEventListener('click', function() {
                container.removeChild(newItem);
                updateExperienceFromForm();
                updatePreview();
            });
            
            // Add event listeners to new inputs
            const inputs = newItem.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            // Update data
            resumeData.experience.push({
                title: "",
                company: "",
                start: "",
                end: "",
                description: ""
            });
            
            updatePreview();
        }
        
        // Add new education field
        function addEducation() {
            const container = document.getElementById('education-container');
            const newItem = document.createElement('div');
            newItem.className = 'education-item';
            newItem.innerHTML = `
                <button class="remove-btn">
                    <i class="fas fa-times"></i>
                </button>
                <div class="form-row">
                    <div class="form-group">
                        <label>Degree</label>
                        <input type="text" class="form-control edu-degree" placeholder="Degree">
                    </div>
                    <div class="form-group">
                        <label>Institution</label>
                        <input type="text" class="form-control edu-school" placeholder="Institution">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Field of Study</label>
                        <input type="text" class="form-control edu-field" placeholder="Field of Study">
                    </div>
                    <div class="form-group">
                        <label>Graduation Year</label>
                        <input type="text" class="form-control edu-year" placeholder="Year">
                    </div>
                </div>
            `;
            
            container.appendChild(newItem);
            
            // Add event listener to the remove button
            const removeBtn = newItem.querySelector('.remove-btn');
            removeBtn.addEventListener('click', function() {
                container.removeChild(newItem);
                updateEducationFromForm();
                updatePreview();
            });
            
            // Add event listeners to new inputs
            const inputs = newItem.querySelectorAll('input');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
            });
            
            // Update data
            resumeData.education.push({
                degree: "",
                school: "",
                field: "",
                year: ""
            });
            
            updatePreview();
        }
        
        // Update experience data from form
        function updateExperienceFromForm() {
            const experienceItems = document.querySelectorAll('.experience-item');
            resumeData.experience = [];
            
            experienceItems.forEach(item => {
                const title = item.querySelector('.exp-title')?.value || "";
                const company = item.querySelector('.exp-company')?.value || "";
                const start = item.querySelector('.exp-start')?.value || "";
                const end = item.querySelector('.exp-end')?.value || "";
                const description = item.querySelector('.exp-desc')?.value || "";
                
                if (title || company) {
                    resumeData.experience.push({
                        title,
                        company,
                        start,
                        end,
                        description
                    });
                }
            });
        }
        
        // Update education data from form
        function updateEducationFromForm() {
            const educationItems = document.querySelectorAll('.education-item');
            resumeData.education = [];
            
            educationItems.forEach(item => {
                const degree = item.querySelector('.edu-degree')?.value || "";
                const school = item.querySelector('.edu-school')?.value || "";
                const field = item.querySelector('.edu-field')?.value || "";
                const year = item.querySelector('.edu-year')?.value || "";
                
                if (degree || school) {
                    resumeData.education.push({
                        degree,
                        school,
                        field,
                        year
                    });
                }
            });
        }
        
        // Apply selected template
        function applyTemplate() {
            previewSection.className = '';
            previewSection.classList.add(`template-${resumeData.template}`);
        }
        
        // Download PDF
        function downloadPDF() {
            const element = document.getElementById('resume-preview');
            const opt = {
                margin: [0.5, 0.5],
                filename: `${resumeData.personal.name.replace(/\s+/g, '_')}_Resume.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2 },
                jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
            };
            
            html2pdf().set(opt).from(element).save().then(() => {
                // Show success toast
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            });
        }
        
        // Reset form
        function resetForm() {
            if (confirm("Are you sure you want to reset all fields?")) {
                document.getElementById('resume-form').reset();
                document.getElementById('experience-container').innerHTML = '';
                document.getElementById('education-container').innerHTML = '';
                
                // Reset data
                resumeData = {
                    personal: {
                        name: "",
                        title: "",
                        email: "",
                        phone: "",
                        location: "",
                        summary: ""
                    },
                    experience: [],
                    education: [],
                    skills: [],
                    template: "1"
                };
                
                // Reset template
                templateOptions.forEach(opt => opt.classList.remove('active'));
                document.querySelector('.template-option[data-template="1"]').classList.add('active');
                
                // Add one empty experience and education item
                addExperience();
                addEducation();
                
                updatePreview();
            }
        }
        
        // Print resume
        function printResume() {
            window.print();
        }
    });
</script>

{% endblock %}